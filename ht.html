<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Statement</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            width: 80%;
            margin: 0 auto;
            border: 1px solid #000;
            padding: 20px;
            font-weight: bold;
            box-sizing: border-box;
        }
        h1, h2 {
            text-align: center;
        }
        .address {
            text-align: center;
            margin: 0;
        }
        p {
            margin: 5px 0;
        }
        .info-tables {
            display: flex;
            justify-content: space-between;
        }
        .info-table {
            width: 48%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .info-table td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }
        .salary-table, .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .salary-table th, .salary-table td, .summary-table th, .summary-table td {
            border: 1px solid #000;
            padding: 8px;
        }
        .salary-table th[colspan="2"] {
            text-align: center;
        }
        .salary-table td {
            text-align: left;
        }
        .salary-table th[colspan="2"],
        .salary-table td:nth-child(2),
        .salary-table td:nth-child(4) {
            text-align: center;
        }
        .summary-table th, .summary-table td {
            text-align: center;
            padding: 10px 0;
            font-weight: bold;
        }
        .signature-section {
            margin-top: 40px;
        }
        .signature {
            font-weight: bold;
            margin-bottom: 1.5cm;
        }
        .signature-section p {
            margin: 5px 0;
        }
        .signatory-details {
            margin-top: 0;
        }
        .footer-text {
            margin-top: 20px;
            text-align: left;
            font-size: 0.9em;
            font-weight: normal;
        }
        .bold-underline {
            font-weight: bold;
            text-decoration: underline;
        }
        .button-container {
            margin-bottom: 20px;
            text-align: center;
        }
        @media print {
            body, html {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
            .container {
                width: 100%;
                height: 100%;
                padding: 10px;
                box-sizing: border-box;
                transform: scale(0.9);
                transform-origin: top left;
            }
            .button-container {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="button-container">
        <input type="file" id="file-input">
        <input type="text" id="employee-id" placeholder="Enter Employee ID">
        <button onclick="searchEmployee()">Search</button>
        <button onclick="printPayslip()">Print</button>
    </div>

    <div class="container">
        <h1>SYMBIOSYS TECHNOLOGIES</h1>
        <p class="address">
            Plot No 138, Hill no-2, IT Park,<br>
            Rushikonda, Visakhapatnam-45<br>
            Ph: 2553084, 2550367
        </p>
        <h2><span class="bold-underline">SALARY STATEMENT FOR THE MONTH </span></h2>
        
        <div class="info-tables">
            <table class="info-table">
                <tr>
                    <td>Employee Code</td>
                    <td id="employee-code"></td>
                </tr>
                <tr>
                    <td>Employee Name</td>
                    <td id="employee-name"></td>
                </tr>
                <tr>
                    <td>Designation</td>
                    <td id="designation"></td>
                </tr>
            </table>
            <table class="info-table">
                <tr>
                    <td>Date Of Joining</td>
                    <td id="date-of-joining"></td>
                </tr>
                <tr>
                    <td>Employee Status</td>
                    <td id="employee-status"></td>
                </tr>
                <tr>
                    <td>Statement For The Month</td>
                    <td id="statement-for-the-month"></td>
                </tr>
            </table>
        </div>
        
        <table class="salary-table">
            <thead>
                <tr>
                    <th colspan="2">Classified Income</th>
                    <th colspan="2">Deductions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Basic Pay</td>
                    <td id="basic-pay">Rs. 0.00</td>
                    <td>Professional Tax</td>
                    <td id="professional-tax">Rs. 0.00</td>
                </tr>
                <tr>
                    <td>House Rent Allowance</td>
                    <td id="house-rent-allowance">Rs. 0.00</td>
                    <td>Income Tax</td>
                    <td id="income-tax">Rs. 0.00</td>
                </tr>
                <tr>
                    <td>City Compensatory Allowance</td>
                    <td id="city-compensatory-allowance">Rs. 0.00</td>
                    <td>Provident Fund</td>
                    <td id="provident-fund">Rs. 0.00</td>
                </tr>
                <tr>
                    <td>Travel Allowance</td>
                    <td id="travel-allowance">Rs. 0.00</td>
                    <td>ESI</td>
                    <td id="esi">Rs. 0.00</td>
                </tr>
                <tr>
                    <td>Food Allowance</td>
                    <td id="food-allowance">Rs. 0.00</td>
                    <td>Leaves-Loss of Pay</td>
                    <td id="loss-of-pay">Rs. 0.00</td>
                </tr>
                <tr>
                    <td>Performance Incentives</td>
                    <td id="performance-incentives">Rs. 0.00</td>
                    <td>Others</td>
                    <td id="others">Rs. 0.00</td>
                </tr>
            </tbody>
        </table>
        
        <table class="summary-table">
            <thead>
                <tr>
                    <th>GROSS PAY</th>
                    <th>DEDUCTIONS</th>
                    <th>NET PAY</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="gross-pay">Rs. 0.00</td>
                    <td id="deductions">Rs. 0.00</td>
                    <td id="net-pay">Rs. 0.00</td>
                </tr>
            </tbody>
        </table>
        
        <div class="signature-section">
            <p class="signature">AUTHORISED SIGNATORY</p>
            <p class="signatory-details">Durgaaprasadh,<br>H.R Executive</p>
        </div>
        <p class="footer-text">We request you to verify employment details with our office on email: hr@symbiostech.com (+91-0891-2550369)</p>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script>
        function searchEmployee() {
            const fileInput = document.getElementById('file-input');
            const employeeId = document.getElementById('employee-id').value;
        
            if (!fileInput.files.length || !employeeId) {
                alert('Please upload an Excel file and enter an Employee ID');
                return;
            }
        
            const file = fileInput.files[0];
            const reader = new FileReader();
        
            reader.onload = function(event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
        
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];
                const json = XLSX.utils.sheet_to_json(sheet);
        
                console.log('Excel Data:', json); // Log the entire data for debugging
        
                const employeeData = json.find(employee => employee['Employee Code'] === employeeId);
        
                if (employeeData) {
                    console.log('Employee Data:', employeeData); // Log the specific employee data for debugging
                    fillTemplate(employeeData);
                } else {
                    alert('Employee not found');
                }
            };
        
            reader.readAsArrayBuffer(file);
        }
        
        function fillTemplate(employeeData) {
            document.getElementById('employee-code').textContent = employeeData['Employee Code'] || 'N/A';
            document.getElementById('employee-name').textContent = employeeData['Employee Name'] || 'N/A';
            document.getElementById('designation').textContent = employeeData['Designation'] || 'N/A';
        
            const dateOfJoining = employeeData['Date Of Joining'];
            console.log('Date Of Joining (raw):', dateOfJoining); // Log raw date
            document.getElementById('date-of-joining').textContent = formatDate(employeeData['DOJ']);
        
            document.getElementById('employee-status').textContent = employeeData['Employee Status'] || 'N/A';
            document.getElementById('statement-for-the-month').textContent = formatDate(employeeData['Statement For The Month']);
        
            // Dynamically update the heading
            const statementMonth = formatDate(employeeData['Statement For The Month']);
            document.querySelector('.bold-underline').textContent = `SALARY STATEMENT FOR THE MONTH OF ${statementMonth.toUpperCase()}`;
        
            document.getElementById('basic-pay').textContent = `Rs. ${employeeData['Basic Pay'] || '0.00'}`;
            document.getElementById('house-rent-allowance').textContent = `Rs. ${employeeData['House Rent Allowance'] || '0.00'}`;
            document.getElementById('city-compensatory-allowance').textContent = `Rs. ${employeeData['City Compensatory Allowance'] || '0.00'}`;
            document.getElementById('travel-allowance').textContent = `Rs. ${employeeData['Travel Allowance'] || '0.00'}`;
            document.getElementById('food-allowance').textContent =` Rs. ${employeeData['Food Allowance'] || '0.00'}`;
            document.getElementById('performance-incentives').textContent = `Rs. ${employeeData['Performance Incentives'] || '0.00'}`;
            document.getElementById('professional-tax').textContent = `Rs. ${employeeData['Professional Tax'] || '0.00'}`;
            document.getElementById('income-tax').textContent = `Rs. ${employeeData['Income Tax'] || '0.00'}`;
            document.getElementById('provident-fund').textContent = `Rs. ${employeeData['Provident Fund'] || '0.00'}`;
            document.getElementById('esi').textContent = `Rs. ${employeeData['ESI'] || '0.00'}`;
            document.getElementById('loss-of-pay').textContent =`Rs. ${employeeData['Leaves-Loss of Pay'] || '0.00'}`;
            document.getElementById('others').textContent = `Rs. ${employeeData['Others'] || '0.00'}`;
            document.getElementById('gross-pay').textContent =` Rs. ${employeeData['GROSS PAY'] || '0.00'}`;
            document.getElementById('deductions').textContent = `Rs. ${employeeData['DEDUCTIONS'] || '0.00'}`;
            document.getElementById('net-pay').textContent =` Rs. ${employeeData['NET PAY'] || '0.00'}`;
        }
        
        
        function formatDate(excelDate) {
            if (!excelDate) return ''; // Return empty if date is not provided
        
            console.log('Formatting Date:', excelDate); // Log the date to be formatted
        
            // Check if the date is a number (Excel serial date)
            if (!isNaN(excelDate)) {
                const date = new Date((excelDate - 25569) * 86400 * 1000);
                return moment(date).format('DD-MM-YYYY');
            } else {
                // Try to parse the date as a string
                const date = moment(excelDate, ["DD/MM/YYYY", "MM/DD/YYYY", "YYYY-MM-DD", "DD-MM-YYYY"]);
                if (date.isValid()) {
                    return date.format('DD-MM-YYYY');
                } else {
                    console.error('Invalid date format:', excelDate); // Log invalid date format
                    return excelDate; // If parsing fails, return the original string
                }
            }
        }
        
        function printPayslip() {
            const printContents = document.querySelector('.container').outerHTML;
            const originalContents = document.body.innerHTML;
            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
            location.reload();
        }
        
    </script>        
</body>
</html>